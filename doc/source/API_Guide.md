# API Guide

## Oceans 3.0 API overview

Check [here](https://wiki.oceannetworks.ca/display/O2A/API+Overview) for more information.

## Glossary of terms

Check [here](https://wiki.oceannetworks.ca/display/O2A/Glossary+of+Terms) for more information.

## The ONC class

The [ONC](#onc.onc.ONC) class provides a wrapper for Oceans 3.0 API requests.
All the client library's functionality is provided as methods of this class.
Each [Oceans 3.0 public API](https://data.oceannetworks.ca/OpenAPI) has a corresponding public method in this class.
In addition, the ONC class provides some useful helper methods that involve multiple APIs to simplify the workflow.

Create an ONC object to access this library's functionalities.

```python
from onc import ONC

onc = ONC("YOUR_TOKEN_HERE")
```

## Discovery methods

Discovery methods can be used to search for available locations, deployments, device categories, devices, properties, and data products.
They support numerous filters and might resemble an "advanced search" function for ONC data sources.

Use discovery methods to:

- Obtain the identification codes required to use other API services.
- Explore what's available in a certain location or device.
- Obtain the deployment dates for a device.
- List available data products for download in a particular device or location.

::: {note}

- Locations can contain other locations.
  - "Cambridge bay" may contain separate children locations for its underwater network and shore station.
- Locations can contain device categories, which contain devices, which contain properties.
- Searches can be performed without considering the hierarchy mentioned above.
  - You can search for locations with data on a specific property or search for all properties in a specific location.

:::

|                         Method                          |             Description             |                                   API Endpoint                                   |
| :-----------------------------------------------------: | :---------------------------------: | :------------------------------------------------------------------------------: |
|        [getLocations](#onc.onc.ONC.getLocations)        |          Return locations           |        [/locations](https://data.oceannetworks.ca/OpenAPI#get-/locations)        |
|    [getLocationsTree](#onc.onc.ONC.getLocationsTree)    |       Return a location tree        |   [/locations/tree](https://data.oceannetworks.ca/OpenAPI#get-/locations/tree)   |
|      [getDeployments](#onc.onc.ONC.getDeployments)      | Return a list of device deployments |      [/deployments](https://data.oceannetworks.ca/OpenAPI#get-/deployments)      |
| [getDeviceCategories](#onc.onc.ONC.getDeviceCategories) | Return a list of device categories  | [/deviceCategories](https://data.oceannetworks.ca/OpenAPI#get-/deviceCategories) |
|          [getDevices](#onc.onc.ONC.getDevices)          |      Return a list of devices       |          [/devices](https://data.oceannetworks.ca/OpenAPI#get-/devices)          |
|       [getProperties](#onc.onc.ONC.getProperties)       |     Return a list of properties     |       [/properties](https://data.oceannetworks.ca/OpenAPI#get-/properties)       |
|     [getDataProducts](#onc.onc.ONC.getDataProducts)     |   Return a list of data products    |     [/dataProducts](https://data.oceannetworks.ca/OpenAPI#get-/dataProducts)     |

## Data product download methods

Data product download methods allow you to request and download more than 120 different types of [ONC data products](https://wiki.oceannetworks.ca/display/O2A/Available+Data+Products),
with granular control over what data to obtain, from where, and in what time frame.
They are comparable to the download functionality from ONC's [Data Search](https://data.oceannetworks.ca/DataSearch) tool.

Examples of usage include:

- Downloading PNG plots of sensor readings in a device
- Downloading sensor readings as .mat files, text files, or in commercial manufacturer formats
- Downloading compressed or raw audio files from hydrophones

:::{note}

If the data product requested doesn't exist in our archive, it will be generated by our servers before your download starts.

:::

|                         Method                          |                  Description                  |                                               API Endpoint                                               |
| :-----------------------------------------------------: | :-------------------------------------------: | :------------------------------------------------------------------------------------------------------: |
|  [requestDataProduct](#onc.onc.ONC.requestDataProduct)  |            Request a data product             |  [/dataProductDelivery/request](https://data.oceannetworks.ca/OpenAPI#get-/dataProductDelivery/request)  |
|    [checkDataProduct](#onc.onc.ONC.checkDataProduct)    | Check status of a <br> requested data product |   [/dataProductDelivery/status](https://data.oceannetworks.ca/OpenAPI#get-/dataProductDelivery/status)   |
|      [runDataProduct](#onc.onc.ONC.runDataProduct)      |         Run a requested data product          |      [/dataProductDelivery/run](https://data.oceannetworks.ca/OpenAPI#get-/dataProductDelivery/run)      |
|   [cancelDataProduct](#onc.onc.ONC.cancelDataProduct)   |         Cancel a running data product         |   [/dataProductDelivery/cancel](https://data.oceannetworks.ca/OpenAPI#get-/dataProductDelivery/cancel)   |
|  [restartDataProduct](#onc.onc.ONC.restartDataProduct)  |       Restart a cancelled data product        |  [/dataProductDelivery/restart](https://data.oceannetworks.ca/OpenAPI#get-/dataProductDelivery/restart)  |
| [downloadDataProduct](#onc.onc.ONC.downloadDataProduct) |            Download a data product            | [/dataProductDelivery/download](https://data.oceannetworks.ca/OpenAPI#get-/dataProductDelivery/download) |

Helper methods are listed below.

|                      Method                       |                Description                |
| :-----------------------------------------------: | :---------------------------------------: |
| [orderDataProduct](#onc.onc.ONC.orderDataProduct) | Request, run, and download a data product |

## Near real-time data access methods

Near real-time (as fast as they get into our database) data access methods allow the extraction of sensor data as time-series,
either as processed scalar data with [Quality Assurance and Control flags](https://wiki.oceannetworks.ca/display/DP/Quality+Assurance+Quality+Control) (QAQC)
or directly as raw data obtained from the device in its specific output format.
In contrast to the Data product download methods, this data can be downloaded directly without waiting for any kind of generation process.

Common use cases include:

- Plotting time series from properties in a specific time frame or in "near real-time"
- Quickly obtaining the latest reading from a particular sensor
- Obtaining raw unprocessed data from our instruments (data might require processing to be readable)

::: {note}

The methods `getDirectByLocation()` and `getDirectRawByLocation()` obtain data readings from a location
no matter what device it came from (hence the need to specify a _device category code_ instead of a single _device code_).
You might want to obtain data by location instead of by device, as individual devices are often replaced/repositioned.

Each request to our API can return a maximum of 100,000 samples; larger data requests must be downloaded as a sequence of pages.
Use the _allPages_ parameter to automatically download all pages required for your requested time frame.

:::

|                             Method                              |                             Description                              |                                      API Endpoint                                      |
| :-------------------------------------------------------------: | :------------------------------------------------------------------: | :------------------------------------------------------------------------------------: |
| [getScalardataByLocation](#onc.onc.ONC.getScalardataByLocation) | Return scalar data <br> from a specific location and device category | [/scalardata/location](https://data.oceannetworks.ca/OpenAPI#get-/scalardata/location) |
|   [getScalardataByDevice](#onc.onc.ONC.getScalardataByDevice)   |              Return scalar data from a specific device               |   [/scalardata/device](https://data.oceannetworks.ca/OpenAPI#get-/scalardata/device)   |
|    [getRawdataByLocation](#onc.onc.ONC.getRawdataByLocation)    |  Return raw data <br> from a specific location and device category   |    [/rawdata/location](https://data.oceannetworks.ca/OpenAPI#get-/rawdata/location)    |
|      [getRawdataByDevice](#onc.onc.ONC.getRawdataByDevice)      |                Return raw data from a specific device                |      [/rawdata/device](https://data.oceannetworks.ca/OpenAPI#get-/rawdata/device)      |

Helper methods are listed below.

|                            Method                             |                                     Description                                      |
| :-----------------------------------------------------------: | :----------------------------------------------------------------------------------: |
| [getSensorCategoryCodes](#onc.onc.ONC.getSensorCategoryCodes) | Return a list of sensor category codes <br> prior to querying the scalardata service |
|          [getScalardata](#onc.onc.ONC.getScalardata)          |                                  Return scalar data                                  |
|             [getRawdata](#onc.onc.ONC.getRawdata)             |                                   Return raw data                                    |

## Archive file download methods

These methods allow users to directly download previously generated data product files from our archive.

ONC systems auto-generate and archive files of different types at set time intervals.
These archived files can be downloaded without waiting for a generation process to finish
(potentially faster than [Data product download methods](#data-product-download-methods)).

::: {note}

Archived files have a unique filename (e.g. "NAXYS_HYD_007_20091231T235919.476Z-spect.png")
that includes the device code ("NAXYS_HYD_007") and the UTC date-time
when the data in the file started being measured ("20091231T235919.476Z").
The filename might contain additional information.

:::

::: {caution}

Due to security regulations, some very recent files (e.g. hydrophone.wav files in the last hour) might not be made immediately available.

:::

|                              Method                               |                                        Description                                         |                                       API Endpoint                                       |
| :---------------------------------------------------------------: | :----------------------------------------------------------------------------------------: | :--------------------------------------------------------------------------------------: |
| [getArchivefileByLocation](#onc.onc.ONC.getArchivefileByLocation) | Return a list of available archive files <br> from a specific location and device category | [/archivefile/location](https://data.oceannetworks.ca/OpenAPI#get-/archivefile/location) |
|   [getArchivefileByDevice](#onc.onc.ONC.getArchivefileByDevice)   |            Return a list of available archive files <br> from a specific device            |   [/archivefile/device](https://data.oceannetworks.ca/OpenAPI#get-/archivefile/device)   |
|      [downloadArchivefile](#onc.onc.ONC.downloadArchivefile)      |                                  Download an archive file                                  | [/archivefile/download](https://data.oceannetworks.ca/OpenAPI#get-/archivefile/download) |

Helper methods are listed below.

|                               Method                                |                            Description                            |
| :-----------------------------------------------------------------: | :---------------------------------------------------------------: |
| [downloadDirectArchivefile](#onc.onc.ONC.downloadDirectArchivefile) | Download a list of archived files that match the filters provided |
|            [getArchivefile](#onc.onc.ONC.getArchivefile)            |             Return a list of available archive files              |
